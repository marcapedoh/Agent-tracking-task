<div class="min-h-screen p-6 bg-gray-50">
  <!-- En-t√™te -->
  <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-6">
    <div class="mb-4">
      <h1 class="text-2xl font-bold text-[#002c6b] inline-block mr-2">
        Daily Tracking Statistics
      </h1>
      <span class="text-sm text-[#002c6b]">{{
        today | date : "fullDate"
        }}</span>

      <p class="mt-1 text-gray-600">Monitor cash flow and agent performance</p>

      <div class="mt-3 inline-block px-4 py-1 bg-[#fff4eb] border-l-4 border-[#cc5200] rounded-md shadow-sm">
        <p class="text-[#cc5200] text-sm font-semibold tracking-wide uppercase">
          üîç INACTIVE DETAILS ‚Äî Breakdown of Inactive Agents
        </p>
      </div>
    </div>

    <!-- Filtres en 2 lignes align√©s √† droite -->
    <div class="p-4 bg-white rounded-lg shadow-md">
      <!-- Ligne 1 -->
      <div class="flex flex-wrap items-end justify-between gap-4">
        <!-- Status Filter -->
        <div class="flex flex-col">
          <label for="statusFilter" class="block mb-1 text-sm font-semibold text-gray-700">Status</label>
          <select id="statusFilter" [(ngModel)]="selectedStatus"
            class="w-40 appearance-none px-3 py-2 text-sm border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-[#004080] focus:border-[#004080]">
            <option *ngFor="let option of statusOptions" [value]="option.value">
              {{ option.label }}
            </option>
          </select>
          <div class="absolute inset-y-0 right-3 flex items-center pointer-events-none">
            <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" d="M6 9l6 6 6-6"></path>
            </svg>
          </div>
        </div>

        <!-- Zone Filter -->
        <div class="flex flex-col">
          <label for="zoneFilter" class="block mb-1 text-sm font-semibold text-gray-700">Zone</label>
          <select id="zoneFilter" [(ngModel)]="selectedZone"
            class="w-40 appearance-none px-3 py-2 text-sm border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-[#004080] focus:border-[#004080]">
            <option value>All Zones</option>
            <option *ngFor="let zone of zones" [value]="zone.name">
              {{ zone.name }}
            </option>
          </select>
          <div class="absolute inset-y-0 right-3 flex items-center pointer-events-none">
            <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" d="M6 9l6 6 6-6"></path>
            </svg>
          </div>
        </div>

        <!-- Subzone Filter -->
        <div *ngIf="hasSubzones()" class="flex flex-col">
          <label for="subzoneFilter" class="block mb-1 text-sm font-semibold text-gray-700">Subzone</label>
          <select id="subzoneFilter" [(ngModel)]="selectedSubzone"
            class="w-36 appearance-none px-3 py-2 text-sm border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-[#004080] focus:border-[#004080]">
            <option value>All Subzones</option>
            <option *ngFor="let subzone of zonesWithSub[selectedZone]" [value]="subzone">
              {{ subzone }}
            </option>
          </select>
          <div class="absolute inset-y-0 right-3 flex items-center pointer-events-none">
            <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" d="M6 9l6 6 6-6"></path>
            </svg>
          </div>
        </div>

        <!-- Date Filter -->
        <div class="flex flex-col">
          <label for="dateFilter" class="block mb-1 text-sm font-semibold text-gray-700">Date</label>
          <input id="dateFilter" type="date" [(ngModel)]="selectDate"
            class="w-40 px-3 py-2 text-sm border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-[#004080] focus:border-[#004080]" />
        </div>
      </div>

      <!-- Ligne 2 -->
      <div class="flex flex-wrap items-end justify-between gap-4 mt-5">
        <!-- Inactive Days -->
        <div class="relative">
          <label for="inactiveDays" class="block mb-1 text-sm font-semibold text-gray-700">Inactive Days</label>
          <input id="inactiveDays" type="number" min="1"
            class="w-40 px-3 py-2 text-sm border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-[#004080] focus:border-[#004080]"
            placeholder="e.g. 5" />
        </div>

        <!-- Main Account -->
        <div class="relative">
          <label for="mainAccountAmount" class="block mb-1 text-sm font-semibold text-gray-700">Min Main Account</label>
          <input id="mainAccountAmount" type="number" min="0"
            class="w-40 px-3 py-2 text-sm border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-[#004080] focus:border-[#004080]"
            placeholder="e.g. 10000" />
        </div>

        <!-- Commission Account -->
        <div class="relative">
          <label for="withdrawalAmount" class="block mb-1 text-sm font-semibold text-gray-700">Min Commission
            Account</label>
          <input id="withdrawalAmount" type="number" min="0"
            class="w-40 px-3 py-2 text-sm border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-[#004080] focus:border-[#004080]"
            placeholder="e.g. 5000" />
        </div>
      </div>
    </div>
  </div>

  <div class="grid grid-cols-1 gap-6 mb-4 sm:grid-cols-2 xl:grid-cols-5">
    <!-- Premium Agent Card -->
    <div
      class="group relative p-6 bg-white border border-gray-100 rounded-xl transition duration-300 transform hover:scale-105 hover:shadow-[0_0_15px_2px_#FFD70044] hover:border-amber-400">
      <div class="flex items-center">
        <div class="p-3 mr-4 rounded-lg text-amber-500 bg-amber-50">
          <svg class="w-8 h-8" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <!-- SVG Crown Icon for Premium -->
            <path stroke-linecap="round" stroke-linejoin="round"
              d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z" />
          </svg>
        </div>
        <div>
          <p class="text-sm text-amber-800">Premium Agents</p>
          <h3 class="text-2xl font-bold text-amber-600 counter" data-target="12">
            0
          </h3>
        </div>
      </div>
      <!-- Tooltip -->
      <div
        class="absolute bottom-[-36px] left-1/2 -translate-x-1/2 opacity-0 group-hover:opacity-100 bg-amber-600 text-white text-xs rounded px-3 py-1 shadow-md whitespace-nowrap z-50 transition-opacity duration-300 pointer-events-none">
        Our Premium agents who are supposed to never run out of cashout
      </div>
    </div>

    <!-- Agents 650 Card -->
    <div
      class="group relative p-6 bg-white border border-gray-100 rounded-xl transition duration-300 transform hover:scale-105 hover:shadow-[0_0_15px_2px_#8B5CF644] hover:border-purple-500">
      <div class="flex items-center">
        <div class="p-3 mr-4 text-purple-600 bg-purple-100 rounded-lg">
          <svg class="w-8 h-8" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <!-- SVG User Group Icon -->
            <path stroke-linecap="round" stroke-linejoin="round"
              d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
          </svg>
        </div>
        <div>
          <p class="text-sm text-purple-800">Agents 650</p>
          <h3 class="text-2xl font-bold text-purple-600 counter" data-target="25">
            0
          </h3>
        </div>
      </div>
      <!-- Tooltip -->
      <div
        class="absolute bottom-[-36px] left-1/2 -translate-x-1/2 opacity-0 group-hover:opacity-100 bg-purple-600 text-white text-xs rounded px-3 py-1 shadow-md whitespace-nowrap z-50 transition-opacity duration-300 pointer-events-none">
        Our agent who use the 650 platform
      </div>
    </div>

    <!-- Agents 650 and Premium Agents Card -->
    <div
      class="group relative p-6 bg-white border border-gray-100 rounded-xl transition duration-300 transform hover:scale-105 hover:shadow-[0_0_15px_2px_#8B5CF644] hover:border-purple-500">
      <div class="flex items-center">
        <div class="p-3 mr-4 text-purple-600 bg-purple-100 rounded-lg">
          <svg class="w-8 h-8" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <!-- SVG User Group Icon -->
            <path stroke-linecap="round" stroke-linejoin="round"
              d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
          </svg>
        </div>
        <div>
          <p class="text-sm text-purple-800">Premium & Agents 650</p>
          <h3 class="text-2xl font-bold text-purple-600 counter" data-target="25">
            0
          </h3>
        </div>
      </div>
      <!-- Tooltip -->
      <div
        class="absolute bottom-[-36px] left-1/2 -translate-x-1/2 opacity-0 group-hover:opacity-100 bg-purple-600 text-white text-xs rounded px-3 py-1 shadow-md whitespace-nowrap z-50 transition-opacity duration-300 pointer-events-none">
        Our agent who belong to the both categories : 650 & Premium.
      </div>
    </div>

    <!-- Cashout Required Card -->
    <div
      class="group relative p-6 bg-white border border-gray-100 rounded-xl transition duration-300 transform hover:scale-105 hover:shadow-[0_0_15px_2px_#FF660044] hover:border-orange-500">
      <div class="flex items-center">
        <div class="p-3 mr-4 text-purple-600 bg-purple-100 rounded-lg">
          <svg class="w-8 h-8" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round"
              d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z" />
          </svg>
        </div>
        <div>
          <p class="text-sm text-[#002c6b]">Inactive with Cashout Amount</p>
          <h3 class="text-2xl font-bold text-[#002c6b] counter" data-target="18">
            0
          </h3>
        </div>
      </div>
      <!-- Tooltip -->
      <div
        class="absolute bottom-[-36px] left-1/2 -translate-x-1/2 opacity-0 group-hover:opacity-100 bg-[#002c6b] text-white text-xs rounded px-3 py-1 shadow-md whitespace-nowrap z-50 transition-opacity duration-300 pointer-events-none">
        Inactive Agents who have a positive balance on their Cashout Account
      </div>
    </div>

    <!-- Inactive Agents Card -->
    <div
      class="group relative p-6 bg-white border border-gray-100 rounded-xl transition duration-300 transform hover:scale-105 hover:shadow-[0_0_15px_2px_#FF660044] hover:border-orange-500">
      <div class="flex items-center">
        <div class="p-3 mr-4 text-yellow-600 bg-yellow-100 rounded-lg">
          <svg class="w-8 h-8" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round"
              d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M16 7h1m-4 0h1m5 4v3m0 0v3m0-3h-3m3 0h-3" />
          </svg>
        </div>
        <div class="flex-1">
          <p class="text-sm text-[#002c6b]">Inactive with Main Account</p>
          <h3 class="text-2xl font-bold text-[#002c6b]">
            <span class="counter">0</span>
          </h3>
        </div>
      </div>
      <!-- Tooltip -->
      <div
        class="absolute bottom-[-36px] left-1/2 -translate-x-1/2 opacity-0 group-hover:opacity-100 bg-[#002c6b] text-white text-xs rounded px-3 py-1 shadow-md whitespace-nowrap z-50 transition-opacity duration-300 pointer-events-none">
        Inactive Agents who have a positive balance on their Main Account.
      </div>
    </div>

    <!-- Inactive Agents Card -->
    <div
      class="group relative p-6 bg-white border border-gray-100 rounded-xl transition duration-300 transform hover:scale-105 hover:shadow-[0_0_15px_2px_#FF660044] hover:border-orange-500">
      <div class="flex items-center">
        <div class="p-3 mr-4 text-yellow-600 bg-yellow-100 rounded-lg">
          <svg class="w-8 h-8" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round"
              d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
        </div>
        <div class="flex-1">
          <p class="text-sm text-[#002c6b]">
            Inactive Agents with Both Balance
          </p>
          <h3 class="text-2xl font-bold text-[#002c6b]">
            <span class="counter">0</span>
          </h3>
        </div>
      </div>
      <!-- Tooltip -->
      <div
        class="absolute bottom-[-36px] left-1/2 -translate-x-1/2 opacity-0 group-hover:opacity-100 bg-[#002c6b] text-white text-xs rounded px-3 py-1 shadow-md whitespace-nowrap z-50 transition-opacity duration-300 pointer-events-none">
        Our agents who have positive balance on their both accounts.
      </div>
    </div>
  </div>

  <!-- Alerts Table Section -->
  <div class="p-6 mb-8 bg-white border border-gray-100 rounded-lg shadow-sm">
    <div class="flex flex-wrap items-center gap-4 p-3 mb-4 rounded-lg bg-[#004080]">
      <span class="text-sm font-medium text-white">Agent Status:</span>

      <div class="flex items-center">
        <span class="w-3 h-3 mr-2 bg-blue-500 rounded-full"></span>
        <span class="text-sm text-white">Inactive ‚Äì Main Account Only</span>
      </div>

      <div class="flex items-center">
        <span class="w-3 h-3 mr-2 bg-purple-500 rounded-full"></span>
        <span class="text-sm text-white">Inactive ‚Äì Cashout Account Only</span>
      </div>

      <div class="flex items-center">
        <span class="w-3 h-3 mr-2 bg-yellow-500 rounded-full"></span>
        <span class="text-sm text-white">Inactive ‚Äì Both Accounts</span>
      </div>
    </div>

    <!-- Table Header with Filters -->
    <div class="flex flex-col items-start justify-between mb-4 space-y-4 md:flex-row md:items-center md:space-y-0">
      <h3 class="text-lg font-semibold text-[#002c6b]">
        Inactive Agents Alerts List:
        {{ selectedZone ? selectedZone : "All Zone" }} /
        {{ selectDate ? selectDate : (today | date : "fullDate") }}
      </h3>

      <div class="flex flex-col w-full space-y-2 sm:flex-row sm:space-y-0 sm:space-x-2 md:w-auto">
        <div class="relative w-40">
          <select id="categoryFilter" [(ngModel)]="selectedCategory"
            class="w-full appearance-none px-3 py-2 text-sm border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-[#004080] focus:border-[#004080]">
            <option value="">All Categories</option>
            <option *ngFor="let category of categories" [value]="category">
              {{ category }}
            </option>
          </select>
          <!-- Ic√¥ne du dropdown correctement positionn√©e -->
          <div class="pointer-events-none absolute inset-y-0 right-3 flex items-center">
            <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" d="M6 9l6 6 6-6"></path>
            </svg>
          </div>
        </div>
      </div>
    </div>

    <!-- Agents Table -->
    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-[#004080] sticky top-0 z-10">
          <tr>
            <th scope="col" class="relative px-3 py-3 text-center">
              <input type="checkbox"
                class="w-4 h-4 mx-auto text-blue-600 border-gray-300 rounded focus:ring-blue-500" />
            </th>

            <th scope="col" class="px-3 py-3 text-xs font-medium tracking-wider text-center text-white uppercase">
              Last Zone
            </th>
            <th scope="col" class="px-3 py-3 text-xs font-medium tracking-wider text-center text-white uppercase">
              Last Subzone
            </th>
            <th scope="col" class="px-3 py-3 text-xs font-medium tracking-wider text-center text-white uppercase">
              Status
            </th>
            <th scope="col" class="px-3 py-3 text-xs font-medium tracking-wider text-center text-white uppercase">
              Category
            </th>
            <th scope="col" class="px-3 py-3 text-xs font-medium tracking-wider text-center text-white uppercase">
              Agent Code
            </th>
            <th scope="col" class="px-3 py-3 text-xs font-medium tracking-wider text-center text-white uppercase">
              Main Account
            </th>
            <th scope="col" class="px-3 py-3 text-xs font-medium tracking-wider text-center text-white uppercase">
              Cashout Account
            </th>
            <th scope="col" class="px-3 py-3 text-xs font-medium tracking-wider text-center text-white uppercase">
              Inactive Days
            </th>
            <th scope="col" class="px-3 py-3 text-xs font-medium tracking-wider text-center text-white uppercase">
              Phone Number
            </th>
          </tr>
        </thead>

        <!-- Corps du tableau -->
        <tbody class="bg-white divide-y divide-gray-200">
          <tr *ngFor="let agent of snapshots" class="transition-colors duration-150 cursor-pointer hover:bg-gray-50"
            (click)="openAgentModal(agent)">
            <!-- Checkbox pour s√©lectionner l'agent (√©viter la propagation du clic) -->
            <td class="px-3 py-4 text-center whitespace-nowrap" (click)="$event.stopPropagation()">
              <input type="checkbox" [checked]="isAgentSelected(agent)"
                class="w-4 h-4 mx-auto text-blue-600 border-gray-300 rounded focus:ring-blue-500" />
            </td>

            <!-- Affichage de la zone, ou "-" si nul -->
            <td class="px-3 py-4 text-sm text-center text-gray-500 whitespace-nowrap">
              {{ agent.zone ?? "-" }}
            </td>

            <!-- Affichage de la subzone avec gestion null, '[NULL]' et cha√Æne vide -->
            <td class="px-3 py-4 text-sm text-center text-gray-500 whitespace-nowrap">
              {{ sanitizeValue(agent.subZone) }}
            </td>

            <!-- Indicateurs de statut sous forme de points color√©s -->
            <td class="px-3 py-4 text-center whitespace-nowrap">
              <div class="flex items-center justify-center gap-2">
                <span *ngIf="agent.agentStatus?.toUpperCase() === 'NEED_CASHING'"
                  class="inline-block w-5 h-5 bg-blue-500 rounded-full" title="Need Cashing"></span>
                <span *ngIf="agent.agentStatus?.toUpperCase() === 'NEED_CASHOUT'"
                  class="inline-block w-5 h-5 bg-purple-500 rounded-full" title="Need Cashout"></span>
                <span *ngIf="agent.agentStatus?.toUpperCase() === 'AUTO_TRANSFER'"
                  class="inline-block w-5 h-5 bg-yellow-500 rounded-full" title="Eligible for Auto Transfer"></span>

                <!-- Si aucun statut, affiche un tiret -->
                <span *ngIf="!agent.agentStatus">-</span>
              </div>
            </td>

            <!-- Affichage de la cat√©gorie avec mapping des valeurs -->
            <td class="px-3 py-4 text-sm text-center text-gray-500 whitespace-nowrap">
              <ng-container [ngSwitch]="agent.category">
                <span *ngSwitchCase="'650'">650</span>
                <span *ngSwitchCase="'Premium'">Premium</span>
                <span *ngSwitchCase="'650_and_Premium'">650 & Premium</span>
                <span *ngSwitchCase="'Ordinary'">Ordinary</span>
                <!-- Valeur par d√©faut si null ou inconnue -->
                <span *ngSwitchDefault>-</span>
              </ng-container>
            </td>

            <!-- Code de l'agent, ou "-" si nul -->
            <td class="px-3 py-4 text-sm font-medium text-center text-gray-900 whitespace-nowrap">
              {{ agent.shortCode ?? "-" }}
            </td>

            <!-- Num√©ro de t√©l√©phone, ou "-" si nul -->
            <td class="px-3 py-4 text-sm text-center text-gray-500 whitespace-nowrap">
              {{ agent.msisdn ?? "-" }}
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    <!-- Pagination Summary and Controls -->
    <div class="flex flex-col-reverse md:flex-row md:items-center md:justify-between px-4 mt-4 space-y-4 md:space-y-0">
      <!-- Left: Summary and Loading -->
      <div>
        <div class="text-sm text-gray-500">
          Page {{ currentPage }} of {{ totalPages }} ‚Äî {{ totalElements }} items
          found
        </div>
        <div *ngIf="loading" class="text-sm text-blue-500 mt-1">
          Loading in progress...
        </div>
      </div>
      <!-- Right: Items per page selector and navigation buttons -->
      <div class="flex flex-col sm:flex-row items-center space-y-2 sm:space-y-0 sm:space-x-4">
        <!-- Items per page dropdown -->
        <div class="flex items-center space-x-2">
          <label for="itemsPerPage" class="text-sm font-medium text-gray-700">Items per page:</label>
          <select id="itemsPerPage" [(ngModel)]="itemsPerPage" (change)="onItemsPerPageChange()"
            class="w-20 px-2 py-1 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            <option *ngFor="let option of itemsPerPageOptions" [value]="option">
              {{ option }}
            </option>
          </select>
        </div>

        <!-- Navigation buttons -->
        <div class="flex items-center space-x-1">
          <button class="px-3 py-1 bg-gray-200 rounded hover:bg-gray-300 disabled:opacity-50"
            [disabled]="currentPage === 1" (click)="changePage(currentPage - 1)">
            &laquo; Previous
          </button>

          <button *ngFor="let page of getPageNumbers()" class="px-3 py-1 text-sm rounded hover:bg-gray-300" [ngClass]="{
              'bg-blue-600 text-white': currentPage === page,
              'bg-gray-200': currentPage !== page
            }" (click)="changePage(page)">
            {{ page }}
          </button>

          <button class="px-3 py-1 bg-gray-200 rounded hover:bg-gray-300 disabled:opacity-50"
            [disabled]="currentPage === totalPages" (click)="changePage(currentPage + 1)">
            Next &raquo;
          </button>
        </div>
      </div>
    </div>
  </div>
</div>